<?xml version="1.0"?>
<configuration>
	<configSections>
		<section name="monorail" type="Castle.MonoRail.Framework.Configuration.MonoRailSectionHandler, Castle.MonoRail.Framework"/>
		<section name="castle" type="Castle.Windsor.Configuration.AppDomain.CastleSectionHandler, Castle.Windsor"/>
		<section name="brail" type="Castle.MonoRail.Views.Brail.BrailConfigurationSection, Castle.MonoRail.Views.Brail"/>
		<section name="activerecord" type="Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord"/>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/>
		<sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
			<section name="Rhino.Commons.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false"/>
		</sectionGroup>
	</configSections>
	<applicationSettings>
		<Rhino.Commons.Properties.Settings>
			<setting name="WindsorConfig" serializeAs="String">
				<value>Windsor.boo</value>
			</setting>
		</Rhino.Commons.Properties.Settings>
	</applicationSettings>
	<connectionStrings>
		<add name="Default" connectionString="Server=(local);initial catalog=membrane;Integrated Security=SSPI"/>
	</connectionStrings>
	<monorail useWindsorIntegration="true">
		<controllers>
			<assemblies>Membrane</assemblies>
			<assemblies>Castle.Monorail.ViewComponents</assemblies>
		</controllers>
		<viewEngines viewPathRoot="Views">
			<add xhtmlrendering="true" type="Castle.MonoRail.Views.Brail.BooViewEngine, Castle.MonoRail.Views.Brail"/>
		</viewEngines>
	</monorail>
	<!--  
		For more on MonoRail configuration see 
		http://www.castleproject.org/monorail/documentation/v1rc3/index.html
	-->
	<activerecord isWeb="true" pluralizeTableNames="true">
		<config>
			<add key="connection.driver_class" value="NHibernate.Driver.SqlClientDriver"/>
			<add key="dialect" value="NHibernate.Dialect.MsSql2000Dialect"/>
			<add key="connection.provider" value="NHibernate.Connection.DriverConnectionProvider"/>
			<add key="connection.connection_string" value="ConnectionString=${Default}"/>
			<add key="show_sql" value="true"/>
		</config>
	</activerecord>
	<system.web>
		<httpHandlers>
			<add verb="*" path="*.rails" type="Castle.MonoRail.Framework.MonoRailHttpHandlerFactory, Castle.MonoRail.Framework"/>
			<!-- block direct user access to template files -->
			<add verb="*" path="*.vm" type="System.Web.HttpForbiddenHandler"/>
			<add verb="*" path="*.njs" type="System.Web.HttpForbiddenHandler"/>
			<add verb="*" path="*.brail" type="System.Web.HttpForbiddenHandler"/>
			<add verb="*" path="*.brailjs" type="System.Web.HttpForbiddenHandler"/>
			<add verb="*" path="*.st" type="System.Web.HttpForbiddenHandler"/>
		</httpHandlers>
		<httpModules>
      <!--<add name="monorail" type="Castle.MonoRail.Framework.EngineContextModule, Castle.MonoRail.Framework"/>-->
		</httpModules>
		<compilation debug="true"/>
  </system.web>
	<log4net>

		<!-- Define some output appenders -->
		<appender name="trace" type="log4net.Appender.TraceAppender, log4net">
			<layout type="log4net.Layout.PatternLayout,log4net">
				<param name="ConversionPattern" value="%d [%t] %-5p %c [%x] &amp;lt;%P{user}&amp;gt; - %m%n" />
			</layout>
		</appender>

		<appender name="console" type="log4net.Appender.ConsoleAppender, log4net">
			<layout type="log4net.Layout.PatternLayout,log4net">
				<param name="ConversionPattern" value="%d [%t] %-5p %c [%x] &amp;lt;%P{user}&amp;gt; - %m%n" />
			</layout>
		</appender>

		<appender name="rollingFile" type="log4net.Appender.RollingFileAppender,log4net" >
			<param name="File" value="log.txt" />
			<param name="AppendToFile" value="true" />
			<param name="RollingStyle" value="Date" />
			<param name="DatePattern" value="yyyy.MM.dd" />
			<param name="StaticLogFileName" value="true" />

			<layout type="log4net.Layout.PatternLayout,log4net">
				<param name="ConversionPattern" value="%d [%t] %-5p %c [%x] &amp;lt;%X{auth}&amp;gt; - %m%n" />
			</layout>
			
		</appender>

		<root>
			<!-- priority value can be set to ALL|INFO|WARN|ERROR -->
			<priority value="ALL" />
			<appender-ref ref="rollingFile" />
		</root>

	</log4net>

	<!--Container configuration. For more information see http://www.castleproject.org/container/documentation/trunk/manual/windsorconfigref.html-->
	<!--and http://www.castleproject.org/container/documentation/trunk/usersguide/compparams.html-->
	<!--For more on Brail configuration see http://www.castleproject.org/monorail/documentation/trunk/viewengines/brail/index.html-->
  <brail
		debug="true"
		saveToDisk="true"
		saveDirectory="BrailGen"
		batch="false"
		commonScriptsDirectory="CommonScripts">
    <reference assembly="Castle.MonoRail.Framework"/>
    <reference assembly="Membrane.Models"/>
  </brail>

</configuration>
